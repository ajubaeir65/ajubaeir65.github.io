<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jubaeir & Auna's OS V9.6</title>
    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --glass: rgba(255, 255, 255, 0.75);
            --modal-bg: #fff;
            --primary-color: #6c5ce7; 
            --accent-color: #ff7675;
            --navbar-bg: rgba(255, 255, 255, 0.9);
            --card-bg: rgba(255,255,255,0.6);
            --glow-color: rgba(108, 92, 231, 0.5);
        }
        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --glass: rgba(30, 30, 30, 0.85);
            --modal-bg: #2d2d2d;
            --navbar-bg: rgba(40, 40, 40, 0.9);
            --card-bg: rgba(50,50,50,0.6);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; 
            transition: background 0.5s ease;
        }

        /* --- BACKGROUND --- */
        #bg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center; 
            z-index: -3; transition: background-image 0.5s ease-in-out;
            filter: brightness(0.7) blur(3px);
        }
        #seasonal-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -2; overflow: hidden;
        }

        /* --- HEADER ELEMENTS --- */
        #countdown-pill {
            position: fixed; top: 20px; left: 20px; 
            background: var(--primary-color); color: white;
            padding: 10px 20px; border-radius: 30px;
            font-size: 0.9rem; z-index: 1000;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none; 
            animation: pulse-slow 3s infinite;
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: bold;
        }
        @keyframes pulse-slow { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.05);} }

        /* --- SCREENS --- */
        .screen {
            display: none; width: 100vw; height: 100vh;
            position: fixed; top: 0; left: 0;
            flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.5s ease;
        }
        .active-screen { display: flex; opacity: 1; }

        /* Login Screen */
        #login-screen { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 2000; }
        .login-box {
            background: rgba(255, 255, 255, 0.2); padding: 40px;
            border-radius: 15px; backdrop-filter: blur(10px);
            text-align: center; width: 90%; max-width: 400px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); border: 1px solid rgba(255,255,255,0.3);
        }
        .password-wrapper { position: relative; width: 100%; }
        input, select { padding: 12px; border-radius: 8px; border: none; margin-top: 15px; width: 100%; font-size: 16px; outline: none; background: rgba(255,255,255,0.9); }
        .toggle-password {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            cursor: pointer; font-size: 1.2rem; color: #555; margin-top: 7px;
        }
        .btn-enter {
            margin-top: 20px; padding: 12px 30px; background: white; color: #764ba2;
            border: none; border-radius: 30px; cursor: pointer; font-weight: bold;
            transition: transform 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .btn-enter:hover { transform: scale(1.05); }

        /* ABOUT SCREEN */
        #about-screen { background: #000; z-index: 3500; text-align: center; color: white; padding: 20px; }
        .about-content {
            max-width: 500px; width: 100%;
            background: rgba(255,255,255,0.1); padding: 40px;
            border-radius: 20px; backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .rainbow-text {
            font-size: 1.5rem; font-weight: bold; margin-bottom: 20px;
            background: linear-gradient(to right, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            animation: rainbow 3s linear infinite; background-size: 200% 100%;
        }
        @keyframes rainbow { 0% {background-position: 100% 0;} 100% {background-position: 0 0;} }
        .social-icons { margin-top: 30px; display: flex; justify-content: center; gap: 20px; }
        .social-btn {
            width: 50px; height: 50px; border-radius: 50%; background: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer; transition: transform 0.2s; text-decoration: none;
        }
        .social-btn:hover { transform: scale(1.2); }
        .fb { color: #1877F2; } .insta { color: #C13584; } .wa { color: #25D366; }

        /* LETTERS SCREEN */
        #letters-screen { background: var(--bg-color); padding-top: 80px; padding-bottom: 100px; overflow-y: auto; }
        .letters-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px; max-width: 800px; width: 95%; margin: 0 auto;
        }
        .letter-card {
            background: var(--modal-bg); padding: 20px; border-radius: 15px;
            text-align: center; cursor: pointer; transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; overflow: hidden;
            border-bottom: 5px solid var(--accent-color);
        }
        .letter-card:hover { transform: translateY(-5px); }
        .letter-icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .letter-title { font-size: 1rem; font-weight: bold; color: var(--text-color); }
        .letter-lock-icon { position: absolute; top: 10px; right: 10px; font-size: 1.2rem; opacity: 0.6; }

        /* BUCKET LIST SCREEN */
        #bucket-screen { background: var(--bg-color); padding-top: 60px; padding-bottom: 100px; overflow-y: auto; }
        .bucket-container { max-width: 600px; width: 95%; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; }
        .bucket-input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .bucket-item { 
            background: var(--modal-bg); padding: 15px; border-radius: 12px; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: all 0.3s;
        }
        .bucket-check { 
            background: #dfe6e9; color: #2d3436; border: none; width: 35px; height: 35px; 
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; 
            transition: background 0.3s;
        }
        .bucket-check:hover { background: var(--primary-color); color: white; }

        /* Calendar UI */
        .calendar-container {
            width: 95%; max-width: 1100px; height: 80vh;
            background: var(--glass);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
            backdrop-filter: blur(10px);
            position: relative; z-index: 10;
            transition: all 0.5s ease;
        }
        #quote-widget {
            background: rgba(255,255,255,0.3);
            color: var(--text-color);
            padding: 10px; text-align: center; font-size: 0.9rem; font-style: italic;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .cal-header { padding: 15px; background: var(--primary-color); color: white; display: flex; justify-content: space-between; align-items: center; border-radius: 20px 20px 0 0; transition: background 0.5s;}
        .nav-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-size: 1.2rem; }
        .cal-body { flex-grow: 1; padding: 10px; overflow-y: auto; }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }

        .day {
            min-height: 80px; background: var(--card-bg); border-radius: 10px;
            padding: 5px; cursor: pointer; border: 1px solid rgba(0,0,0,0.05);
            display: flex; flex-direction: column; justify-content: space-between;
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .day:hover { transform: translateY(-3px); background: var(--modal-bg); box-shadow: 0 0 15px var(--glow-color); }
        .day.today { border: 2px solid var(--primary-color); background: rgba(255,255,255,0.3); }
        
        .event-dots-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 3px; }
        .event-dot { width: 8px; height: 8px; border-radius: 50%; }
        .event-public { background-color: #d63031; }
        .event-personal { background-color: var(--primary-color); }

        /* --- MOOD WIDGET --- */
        #mood-widget {
            position: absolute; top: 15px; right: 20px;
            background: rgba(255,255,255,0.85); padding: 5px 15px;
            border-radius: 20px; display: flex; gap: 10px; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); backdrop-filter: blur(5px);
            z-index: 100;
        }
        .hug-btn { 
            background: #ff7675; color: white; border: none; 
            border-radius: 15px; padding: 5px 10px; cursor: pointer; font-size: 0.8rem;
            animation: pulse-slow 2s infinite;
        }
        .float-heart {
            position: fixed; bottom: -50px; font-size: 2rem;
            animation: floatUp 4s linear forwards; z-index: 5000;
        }
        @keyframes floatUp { 0% {transform: translateY(0) scale(0.5); opacity:1;} 100% {transform: translateY(-110vh) scale(1.5); opacity:0;} }

        /* --- IMMERSIVE EVENT VIEW --- */
        #event-view-screen { z-index: 3000; background: rgba(0,0,0,0.85); color: white; }
        .immersive-container {
            width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; overflow-y: auto; padding: 20px;
        }
        .immersive-card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px);
            border-radius: 20px; padding: 30px; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2); width: 100%; max-width: 500px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative; overflow: hidden;
            text-align: left; transition: box-shadow 0.3s;
        }
        .im-title { font-size: 2rem; margin-bottom: 5px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .im-date { font-size: 1rem; color: #dfe6e9; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .im-age { display: inline-block; background: var(--primary-color); padding: 5px 12px; border-radius: 15px; font-size: 0.9rem; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .im-countdown { font-size: 0.9rem; color: #ffeb3b; margin-bottom: 10px; font-weight: bold; }
        .im-note { font-size: 1.2rem; line-height: 1.6; font-style: italic; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; margin-top: 10px; }
        .audio-controls { margin-top: 25px; display: flex; gap: 15px; align-items: center; background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 30px; width: fit-content; }
        .audio-btn { background: white; color: var(--primary-color); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: transform 0.2s; }

        /* LOVE SCREEN */
        #love-screen { 
            background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); 
            z-index: 2500; text-align: center; overflow: hidden;
        }
        .love-card {
            background: rgba(255,255,255,0.9); padding: 40px; border-radius: 30px;
            max-width: 85%; box-shadow: 0 20px 50px rgba(255, 118, 117, 0.3);
            animation: float 4s ease-in-out infinite; border: 2px solid #fff;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .love-msg { font-size: 1.5rem; color: #d63031; font-family: 'Segoe UI', cursive; margin-bottom: 20px; line-height: 1.4; }

        /* Timeline */
        #timeline-screen { background: var(--bg-color); overflow-y: auto; padding-top: 80px; padding-bottom: 100px; }
        .timeline-container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .tl-item { background: var(--modal-bg); padding: 20px; margin-bottom: 20px; border-radius: 15px; border-left: 5px solid var(--primary-color); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* Navbar */
        .navbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--navbar-bg); padding: 10px 20px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; gap: 15px;
            z-index: 900; backdrop-filter: blur(10px);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: var(--text-color); opacity: 0.7; font-size: 0.65rem; }
        .nav-item:hover { opacity: 1; color: var(--primary-color); }
        .nav-icon { font-size: 20px; margin-bottom: 2px; }

        /* Modals */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); justify-content: center; align-items: center;
            z-index: 4000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--modal-bg); padding: 25px; border-radius: 15px;
            width: 90%; max-width: 450px; text-align: center; color: var(--text-color);
            max-height: 85vh; overflow-y: auto; position: relative;
        }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; }
        .menu-btn { position: absolute; top: 15px; right: 15px; color: white; font-size: 24px; cursor: pointer; z-index: 100; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .add-btn {  
            position: absolute; bottom: 90px; right: 20px;  
            width: 50px; height: 50px; background: var(--primary-color);  
            color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;  
            font-size: 28px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 50;  
        }

        /* Letter Modal */
        #letter-content-modal { background: #fffdf0; color: #333; font-family: 'Courier New', Courier, monospace; line-height: 1.6; }
        .letter-paper {
            background: #fffdf0; padding: 20px; border: 1px solid #ddd;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1); text-align: left;
        }

        /* Particles */
        .particle { position: absolute; top: -20px; pointer-events: none; animation-timing-function: linear; }
        @keyframes fall { to { transform: translateY(105vh); } }
        .snowflake { color: white; opacity: 0.8; font-size: 1.5rem; animation-name: fall; }
        .rain { background: rgba(255,255,255,0.6); width: 2px; height: 15px; animation-name: fall; }
        .leaf { opacity: 0.9; font-size: 1.2rem; animation-name: fall; }

    </style>
</head>
<body>
<div id="bg-container"></div>
<div id="seasonal-layer"></div>

<div id="countdown-pill">‚è≥ Loading...</div>

<div id="login-screen" class="screen active-screen">
    <div class="login-box">
        <h2 style="color:white; margin-bottom:10px;">Relationship OS <small style="font-size:0.5em; opacity:0.7">V9.6</small></h2>
        <p style="color:white; opacity:0.8; margin-bottom:20px;">Auna & Jubaeir</p>
        <div class="password-wrapper">
            <input type="password" id="password-input" placeholder="Enter Password">
            <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
        </div>
        <button class="btn-enter" onclick="checkPassword()">Unlock</button>
    </div>
</div>

<div id="love-screen" class="screen">
    <div id="love-particles"></div>
    <div class="love-card">
        <div id="daily-love-msg" class="love-msg"></div>
        <div class="love-sub">~ Yours, Jubaeir</div>
        <br>
        <button class="btn-enter" onclick="goCalendarFromLove()">Go to Calendar</button>
    </div>
</div>

<div id="about-screen" class="screen">
    <button onclick="closeAboutScreen()" style="position:absolute; top:20px; right:20px; background:transparent; border:none; color:white; font-size:2.5rem; cursor:pointer;">&times;</button>
    <div class="about-content">
        <h1 class="rainbow-text">Creator name: Jubaeir Ahsan</h1>
        <h2 class="rainbow-text" style="font-size:1.2rem;">Created for his beautiful wife: Fatema Tuj Zohura</h2>
        
        <div class="social-icons">
            <a href="https://facebook.com/abu.jubaeir.65" target="_blank" class="social-btn fb">f</a>
            <a href="https://instagram.com/abu.jubaeir.65" target="_blank" class="social-btn insta">üì∏</a>
            <a href="https://wa.me/8801782455227" target="_blank" class="social-btn wa">üìû</a>
        </div>
    </div>
</div>

<div id="bucket-screen" class="screen">
    <h2 style="text-align:center; padding:20px; color:var(--primary-color);">Our Bucket List üìù</h2>
    <div class="bucket-container">
        <div class="bucket-input-group">
            <input type="text" id="bucket-input" placeholder="Add a new dream..." style="margin-top:0;">
            <button class="btn-enter" onclick="addBucketItem()" style="margin-top:0; border-radius:8px;">Add</button>
        </div>
        <div id="bucket-list-content"></div>
    </div>
</div>

<div id="letters-screen" class="screen">
    <h2 style="text-align:center; padding:20px; color:var(--primary-color);">Open When... ‚úâÔ∏è</h2>
    <p style="text-align:center; margin-bottom:20px; font-size:0.9rem; opacity:0.7;">Digital letters for your heart</p>
    <div class="letters-grid" id="letters-grid"></div>
</div>

<div id="event-view-screen" class="screen">
    <button onclick="closeEventView()" style="position:absolute; top:20px; right:20px; background:transparent; border:none; color:white; font-size:2.5rem; cursor:pointer; z-index:3001;">&times;</button>
    <div class="immersive-container">
        <div id="event-cards-wrapper" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
    </div>
</div>

<div id="timeline-screen" class="screen">
    <h2 style="text-align:center; padding:20px; color:var(--primary-color);">Memory Lane üõ§Ô∏è</h2>
    <div class="timeline-container" id="timeline-content"></div>
</div>

<div id="calendar-screen" class="screen">
    <div class="menu-btn" onclick="openSettings()">&#8942;</div>
    
    <div id="mood-widget">
        <select id="mood-select" onchange="setMood()" style="border:none; background:transparent; font-size:1.2rem; width:auto; padding:0; margin:0; cursor:pointer;">
            <option value="üòä">üòä Happy</option>
            <option value="‚ù§Ô∏è">‚ù§Ô∏è Loved</option>
            <option value="ü•∫">ü•∫ Miss You</option>
            <option value="üò¥">üò¥ Tired</option>
        </select>
        <button class="hug-btn" onclick="sendHug()">Send Hug ü´Ç</button>
    </div>

    <div class="calendar-container">
        <div id="quote-widget">Daily Quote Loading...</div>
        <div class="cal-header">
            <button class="nav-btn" onclick="changeMonth(-1)">&#10094;</button>
            <div class="header-text" style="text-align:center;">
                <h1 id="month-year">January 2026</h1>
                <p id="alt-months" style="font-size:0.8rem; opacity:0.9;">Bangla / Hijri</p>
            </div>
            <button class="nav-btn" onclick="changeMonth(1)">&#10095;</button>
        </div>
        
        <div class="cal-body">
            <div class="weekdays">
                <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
            </div>
            <div class="days-grid" id="days-grid"></div>
        </div>
    </div>
    <div class="add-btn" id="add-event-btn" onclick="openAddModal()">+</div>
</div>

<div class="navbar" id="navbar">
    <div class="nav-item" onclick="goHome()">
        <span class="nav-icon">üè†</span><span>Home</span>
    </div>
    <div class="nav-item" onclick="goBucketList()">
        <span class="nav-icon">üìù</span><span>Dreams</span>
    </div>
    <div class="nav-item" onclick="goLetters()">
        <span class="nav-icon">üíå</span><span>Letters</span>
    </div>
    <div class="nav-item" onclick="goTimeline()">
        <span class="nav-icon">üéûÔ∏è</span><span>Timeline</span>
    </div>
    <div class="nav-item" onclick="shuffleMemory()">
        <span class="nav-icon">üé≤</span><span>Shuffle</span>
    </div>
    <div class="nav-item" onclick="goCalendar()">
        <span class="nav-icon">üìÖ</span><span>Calendar</span>
    </div>
</div>

<div id="settings-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('settings-modal')">&times;</span>
        <h2 style="margin-bottom:20px;">Settings</h2>
        
        <div style="text-align:left; margin-bottom:20px;">
            <h3>Theme</h3>
            <button onclick="setAppTheme('auto')">Auto</button>
            <button onclick="setAppTheme('light')">Light</button> 
            <button onclick="setAppTheme('dark')">Dark</button> 
        </div>

        <button onclick="openAboutScreen()" class="btn-enter" style="width:100%; margin-bottom:20px; background: var(--primary-color); color:white;">About Developer</button>

        <div style="text-align:left; margin-bottom:20px; border-top:1px solid #eee; padding-top:10px;">
            <h3>Backup & Restore üíæ</h3>
            <p style="font-size:0.8rem; color:#666; margin-bottom:5px;">Save your memories to a file.</p>
            <button onclick="exportData()" class="btn-enter" style="width:100%; margin-bottom:5px; background:#00b894; color:white;">Export Data (Download)</button>
            <p style="font-size:0.8rem; color:#666; margin-top:10px; margin-bottom:5px;">Restore from a file.</p>
            <input type="file" id="import-file" accept=".json,application/json" style="font-size:0.9rem;">
            <button onclick="importData()" class="btn-enter" style="width:100%; margin-top:5px; padding:8px; background:#0984e3; color:white;">Import Data</button>
        </div>

        <div style="text-align:left; margin-bottom:20px; border-top:1px solid #eee; padding-top:10px;">
            <h3>Voice Notes Manager</h3>
            <select id="voice-event-select" style="margin-top:10px;"></select>
            <input type="file" id="voice-file-input" accept="audio/*" style="font-size:0.9rem;">
            <button onclick="saveVoiceNote()" class="btn-enter" style="width:100%; margin-top:10px; padding:8px;">Save Voice Note</button>
        </div>

        <div style="text-align:left; border-top:1px solid #eee; padding-top:10px;">
            <h3>Monthly Backgrounds</h3>
            <div id="bg-upload-list"></div>
        </div>
    </div>
</div>

<div id="add-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('add-modal')">&times;</span>
        <h2>Add Event</h2>
        <input type="date" id="new-evt-date">
        <input type="text" id="new-evt-title" placeholder="Title">
        <select id="new-evt-mood" style="margin-top:10px;">
            <option value="happy">Happy (Yellow)</option>
            <option value="love">Romantic (Red)</option>
            <option value="sad">Emotional (Blue)</option>
        </select>
        <textarea id="new-evt-note" placeholder="Note" rows="3" style="width:100%; margin-top:10px; padding:5px; border-radius:5px;"></textarea>
        <button class="btn-enter" onclick="saveNewEvent()">Save</button>
    </div>
</div>

<div id="letter-read-modal" class="modal">
    <div class="modal-content" style="background:#fffdf0; color:#333;">
        <span class="close-btn" onclick="closeModal('letter-read-modal')">&times;</span>
        <h2 id="letter-title-display" style="margin-bottom:15px; font-family:'Courier New';"></h2>
        <div class="letter-paper" id="letter-body-display"></div>
    </div>
</div>

<script>
    // --- CONFIG & STATE ---
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth();
    let isAuthenticated = false; 
    let isPublicMode = false;
    let autoHideTimer, particlesInterval;
    let userAudio = new Audio(); 

    const quotes = [
        "In all the world, there is no heart for me like yours.",
        "I saw that you were perfect, and so I loved you.",
        "You are my today and all of my tomorrows.",
        "I love you not only for what you are, but for what I am when I am with you.",
        "Because of you, I laugh a little harder and smile a lot more."
    ];

    const defaultPersonalEvents = [
        { id: 1, d: '2024-01-19', t: "I like you Day", n: "I like you so much AunaüòÅ", mood: 'happy' },
        { id: 2, d: '2025-02-21', t: "First Rose", n: "The day I gave you a rose üåπ", mood: 'love' },
        { id: 3, d: '2025-04-03', t: "Relationship Anniversary", n: "Happy Valentine's Day Sweetheart ‚ù§Ô∏è", mood: 'love' },
        { id: 4, d: '2003-04-05', t: "Auna's Birthday", n: "Happy Birthday my love ü™ªüíú", mood: 'special' },
        { id: 5, d: '2002-10-06', t: "Jubaeir's Birthday", n: "My Birthday ü´£", mood: 'happy' },
        { id: 6, d: '2019-06-08', t: "Int'l Best Friend Day", n: "Happy international best friend day üëä.", mood: 'happy' },
        { id: 7, d: '2025-06-28', t: "Kiss Day 2.0", n: "The day when you first time kiss meüíã.", mood: 'love' },
        { id: 8, d: '1988-08-20', t: "Dad's Birthday", n: "Happy birthday dear Sosur.", mood: 'happy' },
        { id: 9, d: '2008-11-20', t: "Laam's Birthday", n: "Happy birthday Dear brother in law.", mood: 'happy' },
        { id: 10, d: '2022-12-17', t: "My Bestie Day", n: "Happy bestie day jaanüëä.", mood: 'happy' }
    ];

    // LETTERS DATA
    const defaultLetters = [
        { title: "Open when you miss me", icon: "ü•∫", body: "My dearest, remember that even when we are apart, my heart beats only for you. Close your eyes, take a deep breath, and know that I am thinking of you right this second.", lockDate: null },
        { title: "Open when you are sad", icon: "üò¢", body: "I hate seeing you sad. Remember that you are the strongest, most beautiful person I know. This moment will pass, and I will be here to hold your hand through it all.", lockDate: null },
        { title: "Open on our Anniversary", icon: "üíç", body: "Happy Anniversary my love! Another year of us, another year of happiness. I can't wait for a lifetime more.", lockDate: "2025-04-03" } // Example Lock Date
    ];

    let personalEvents = JSON.parse(localStorage.getItem('myEvents_v8')) || defaultPersonalEvents;
    let bucketList = JSON.parse(localStorage.getItem('bucketList_v9')) || [];
    let calendarPass = localStorage.getItem('calPass') || "12345678";
    let customBgs = JSON.parse(localStorage.getItem('monthBgs')) || {}; 
    
    // Month Colors Array
    const monthColors = ['#74b9ff', '#d63031', '#00b894', '#a29bfe', '#fdcb6e', '#e17055', '#0984e3', '#6c5ce7', '#00cec9', '#fab1a0', '#636e72', '#2d3436'];

    const publicHolidays = [
        { d: '02-21', t: "Mother Language Day" }, { d: '03-17', t: "Mujib's Birthday" },
        { d: '03-26', t: "Independence Day" }, { d: '04-14', t: "Bengali New Year" },
        { d: '12-16', t: "Victory Day" }, { d: '12-25', t: "Christmas Day" }
    ];

    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const defaultBgs = [
        "https://images.unsplash.com/photo-1483921020237-2ff51e8e4b22?w=1080", 
        "https://images.unsplash.com/photo-1516527506698-c13f68d6c84c?w=1080",
        "https://images.unsplash.com/photo-1558280417-3e2154ce1179?w=1080", 
        "https://images.unsplash.com/photo-1524235323955-46f909564619?w=1080",
        "https://images.unsplash.com/photo-1590928952136-1e61250325d9?w=1080",
        "https://images.unsplash.com/photo-1568444438385-ece31a33ce78?w=1080",
        "https://images.unsplash.com/photo-1562187760-4927cb4187e1?w=1080",
        "https://images.unsplash.com/photo-1476900164809-ff19b8ae5968?w=1080",
        "https://images.unsplash.com/photo-1478147427282-58a87a120781?w=1080",
        "https://images.unsplash.com/photo-1509210452627-2b36c64c7603?w=1080",
        "https://images.unsplash.com/photo-1445510861639-565415e3441a?w=1080",
        "https://images.unsplash.com/photo-1482517967863-00e15c9b4499?w=1080"
    ];

    // --- INITIALIZATION ---
    window.onload = function() {
        checkAutoTheme();
        renderBgUploadList();
        loadMood();
        document.body.addEventListener('click', resetNavTimer);
        resetNavTimer();
        document.getElementById('quote-widget').innerText = "\"" + quotes[Math.floor(Math.random() * quotes.length)] + "\"";
    };

    function updateCountdown() {
        if(!isAuthenticated) { document.getElementById('countdown-pill').style.display = 'none'; return; }
        const today = new Date(); today.setHours(0,0,0,0);
        let upcoming = [];
        personalEvents.forEach(e => {
            let d = new Date(e.d);
            let nextDate = new Date(today.getFullYear(), d.getMonth(), d.getDate());
            if (nextDate < today) nextDate.setFullYear(today.getFullYear() + 1);
            upcoming.push({ t: e.t, date: nextDate });
        });
        upcoming.sort((a, b) => a.date - b.date);
        if(upcoming.length > 0) {
            let next = upcoming[0];
            let diff = Math.ceil((next.date - today) / (1000 * 60 * 60 * 24));
            let pill = document.getElementById('countdown-pill');
            pill.style.display = 'block';
            pill.innerHTML = `‚ú® <b>${next.t}</b> in ${diff} days`;
        }
    }

    // --- AUTH ---
    function togglePasswordVisibility() {
        const x = document.getElementById("password-input");
        x.type = (x.type === "password") ? "text" : "password";
    }

    function checkPassword() {
        const pass = document.getElementById('password-input').value;
        if (pass === calendarPass) {
            isAuthenticated = true; isPublicMode = false; goCalendar();
        } else if (pass === "041065") {
            openLoveScreen();
        } else {
            if(confirm("Wrong password. Open in Guest Mode?")) { isAuthenticated = false; isPublicMode = true; goCalendar(); }
        }
    }

    // --- NAVIGATION ---
    function goHome() { isAuthenticated = false; switchScreen('login-screen'); stopAudio(); document.getElementById('countdown-pill').style.display = 'none'; }
    function goCalendar() { 
        switchScreen('calendar-screen'); 
        document.getElementById('add-event-btn').style.display = isAuthenticated ? 'flex' : 'none'; 
        renderCalendar(); stopAudio(); updateCountdown(); 
    }
    function goCalendarFromLove() { isAuthenticated = false; isPublicMode = true; goCalendar(); }
    function goTimeline() { renderTimeline(); switchScreen('timeline-screen'); }
    function goBucketList() { if(!isAuthenticated) return alert("Unlock first!"); renderBucketList(); switchScreen('bucket-screen'); }
    function goLetters() { if(!isAuthenticated) return alert("Unlock first!"); renderLetters(); switchScreen('letters-screen'); }

    // --- BACKUP & RESTORE SYSTEM (FIXED) ---
    function exportData() {
        const data = {
            events: personalEvents,
            bucket: bucketList,
            bg: customBgs,
            pass: calendarPass,
            mood: localStorage.getItem('currentMood')
        };
        const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "jubaeir_auna_memories_backup.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function importData() {
        const input = document.getElementById('import-file');
        if(!input.files.length) return alert("Select a file first.");
        
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if(data.events) localStorage.setItem('myEvents_v8', JSON.stringify(data.events));
                if(data.bucket) localStorage.setItem('bucketList_v9', JSON.stringify(data.bucket));
                if(data.bg) localStorage.setItem('monthBgs', JSON.stringify(data.bg));
                if(data.mood) localStorage.setItem('currentMood', data.mood);
                
                alert("Restore successful! Reloading...");
                location.reload();
            } catch(err) {
                alert("Invalid file format!");
            }
        };
        reader.readAsText(file);
    }

    // --- LETTERS LOGIC ---
    function renderLetters() {
        const grid = document.getElementById('letters-grid');
        grid.innerHTML = "";
        const today = new Date().toISOString().split('T')[0];

        defaultLetters.forEach((l, index) => {
            let isLocked = false;
            if(l.lockDate && l.lockDate > today) isLocked = true;

            let div = document.createElement('div');
            div.className = 'letter-card';
            div.innerHTML = `
                ${isLocked ? '<span class="letter-lock-icon">üîí</span>' : ''}
                <span class="letter-icon">${l.icon}</span>
                <div class="letter-title">${l.title}</div>
                ${isLocked ? `<small style="font-size:0.7rem; color:red;">Opens: ${l.lockDate}</small>` : ''}
            `;
            div.onclick = () => openLetter(index, isLocked);
            grid.appendChild(div);
        });
    }

    function openLetter(index, isLocked) {
        if(isLocked) return alert("This letter is locked until the special date! üîí");
        const letter = defaultLetters[index];
        document.getElementById('letter-title-display').innerText = letter.title;
        document.getElementById('letter-body-display').innerText = letter.body;
        document.getElementById('letter-read-modal').style.display = 'flex';
    }

    // --- BUCKET LIST LOGIC ---
    function renderBucketList() {
        const container = document.getElementById('bucket-list-content');
        container.innerHTML = "";
        bucketList.forEach((item, index) => {
            let div = document.createElement('div');
            div.className = "bucket-item";
            div.innerHTML = `
                <span class="bucket-text">${item.t}</span>
                <button class="bucket-check" onclick="completeBucketItem(${index})">‚úì</button>
            `;
            container.appendChild(div);
        });
    }

    function addBucketItem() {
        const val = document.getElementById('bucket-input').value;
        if(val) {
            bucketList.push({ t: val, created: Date.now() });
            localStorage.setItem('bucketList_v9', JSON.stringify(bucketList));
            document.getElementById('bucket-input').value = "";
            renderBucketList();
        }
    }

    function completeBucketItem(index) {
        if(confirm("Mark this dream as completed and move to Memory Lane?")) {
            let item = bucketList[index];
            bucketList.splice(index, 1);
            let today = new Date().toISOString().split('T')[0];
            personalEvents.push({ id: Date.now(), d: today, t: "Dream Accomplished: " + item.t, n: "We did it! One more dream crossed off the list. ‚úÖ", mood: 'happy' });
            localStorage.setItem('bucketList_v9', JSON.stringify(bucketList));
            localStorage.setItem('myEvents_v8', JSON.stringify(personalEvents));
            triggerHearts(); 
            renderBucketList();
        }
    }

    // --- MOOD & HUGS LOGIC ---
    function loadMood() { let m = localStorage.getItem('currentMood'); if(m) document.getElementById('mood-select').value = m; }
    function setMood() { let m = document.getElementById('mood-select').value; localStorage.setItem('currentMood', m); }
    function sendHug() { triggerHearts(); alert("Hug Sent! (Simulated)"); }
    function triggerHearts() {
        for(let i=0; i<15; i++) {
            let h = document.createElement('div');
            h.innerText = "‚ù§Ô∏è";
            h.className = "float-heart";
            h.style.left = Math.random()*100 + "vw";
            h.style.animationDuration = (Math.random()*2 + 3) + "s";
            document.body.appendChild(h);
            setTimeout(() => h.remove(), 5000);
        }
    }

    // --- MEMORY SHUFFLE ---
    function shuffleMemory() {
        if(!isAuthenticated && !isPublicMode) return alert("Please unlock first!");
        const list = isAuthenticated ? personalEvents : publicHolidays.map(p => ({d: currentYear+"-"+p.d, t: p.t, type: 'public'}));
        if(list.length === 0) return;
        const randomEvent = list[Math.floor(Math.random() * list.length)];
        if(!randomEvent.type) randomEvent.type = 'personal';
        openImmersiveEvent([randomEvent], currentYear);
    }

    // --- ABOUT SCREEN ---
    function openAboutScreen() { closeModal('settings-modal'); switchScreen('about-screen'); }
    function closeAboutScreen() { goCalendar(); }

    // --- RENDER CALENDAR ---
    function renderCalendar() {
        const bgContainer = document.getElementById('bg-container');
        bgContainer.style.backgroundImage = `url('${customBgs[currentMonth] || defaultBgs[currentMonth]}')`;
        document.documentElement.style.setProperty('--primary-color', monthColors[currentMonth]);
        updateSeasonalAnimation();
        document.getElementById('month-year').innerText = new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' });
        
        const grid = document.getElementById('days-grid');
        grid.innerHTML = "";
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const startDay = new Date(currentYear, currentMonth, 1).getDay();
        const today = new Date();

        for(let i=0; i<startDay; i++) grid.innerHTML += `<div></div>`;

        for(let d=1; d<=daysInMonth; d++) {
            let mdStr = `${String(currentMonth+1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            let dayEvents = [];
            let pub = publicHolidays.find(e => e.d === mdStr);
            if(pub) dayEvents.push({type: 'public', title: pub.t, d: `${currentYear}-${mdStr}`});
            if(!isPublicMode || isAuthenticated) {
                personalEvents.forEach(evt => {
                    let ed = new Date(evt.d);
                    if (ed.getMonth() === currentMonth && ed.getDate() === d) dayEvents.push({...evt, type: 'personal'});
                });
            }
            let div = document.createElement('div');
            div.className = "day" + (pub ? " holiday" : "");
            if(today.getFullYear() === currentYear && today.getMonth() === currentMonth && today.getDate() === d) div.classList.add('today');
            div.innerHTML = `<div class="day-num">${d}</div>`;
            div.innerHTML += `<div class="event-dots-container">${dayEvents.map(e => `<div class="event-dot event-${e.type}"></div>`).join('')}</div>`;
            if(dayEvents.length > 0) div.onclick = () => openImmersiveEvent(dayEvents, currentYear);
            grid.appendChild(div);
        }
    }

    // --- IMMERSIVE VIEW ---
    function openImmersiveEvent(events, currYear) {
        const wrapper = document.getElementById('event-cards-wrapper');
        wrapper.innerHTML = "";
        const today = new Date(); today.setHours(0,0,0,0);
        events.forEach(event => {
            let card = document.createElement('div');
            card.className = `immersive-card mood-${event.mood || 'happy'}`;
            let evtDate = new Date(event.d);
            let ageText = "";
            let diffYears = currYear - evtDate.getFullYear();
            if(event.type === 'personal') ageText = diffYears > 0 ? `${diffYears}${getOrdinal(diffYears)} Anniversary` : "Original Event Date";
            else ageText = "Public Holiday";

            let thisYearDate = new Date(currYear, evtDate.getMonth(), evtDate.getDate());
            let timeDiff = thisYearDate - today;
            let daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            let countdownText = daysDiff > 0 ? `‚è≥ ${daysDiff} days until` : daysDiff === 0 ? `üéâ IT'S TODAY!` : `‚úÖ ${Math.abs(daysDiff)} days passed`;

            let content = `
                <div class="im-title">${event.title || event.t}</div>
                <div class="im-date">${new Date(event.d).toLocaleString('default',{month:'long', day:'numeric'})}, ${new Date(event.d).getFullYear()}</div>
                <div class="im-age">${ageText}</div>
                <div class="im-countdown">${countdownText}</div>
                ${event.note ? `<div class="im-note">"${event.note}"</div>` : ''}
            `;
            if(event.type === 'personal' && event.audioSrc) {
                content += `<div class="audio-controls"><button class="audio-btn" onclick="playAudio('${event.id}')">‚ñ∂</button><button class="audio-btn" onclick="stopAudio()">‚èπ</button><span style="color:white; font-size:0.9rem;">Voice Note</span></div>`;
            }
            card.innerHTML = content;
            wrapper.appendChild(card);
        });
        switchScreen('event-view-screen');
    }

    // --- AUDIO & VOICE ---
    function playAudio(id) { let evt = personalEvents.find(x => x.id == id); if(evt && evt.audioSrc) { userAudio.src = evt.audioSrc; userAudio.play(); } }
    function stopAudio() { userAudio.pause(); userAudio.currentTime = 0; }
    function closeEventView() { stopAudio(); goCalendar(); }
    function openSettings() {
        if(!isAuthenticated) return alert("Unlock first");
        const select = document.getElementById('voice-event-select');
        select.innerHTML = '<option value="">-- Select Event --</option>';
        personalEvents.forEach(e => { let opt = document.createElement('option'); opt.value = e.id; opt.innerText = e.t + " (" + e.d + ")"; select.appendChild(opt); });
        document.getElementById('settings-modal').style.display = 'flex';
        renderBgUploadList();
    }
    function saveVoiceNote() {
        const select = document.getElementById('voice-event-select');
        const input = document.getElementById('voice-file-input');
        const eventId = select.value;
        if(!eventId || !input.files[0]) return alert("Please select an event and a file.");
        const file = input.files[0];
        if(file.size > 350000) return alert("File too large! Max 350KB allowed.");
        const reader = new FileReader();
        reader.onload = function(e) {
            let idx = personalEvents.findIndex(x => x.id == eventId);
            if(idx !== -1) {
                personalEvents[idx].audioSrc = e.target.result;
                localStorage.setItem('myEvents_v8', JSON.stringify(personalEvents));
                alert("Voice Note Saved Successfully!");
                input.value = "";
            }
        };
        reader.readAsDataURL(file);
    }

    // --- TIMELINE ---
    function renderTimeline() {
        const container = document.getElementById('timeline-content');
        container.innerHTML = "";
        let sorted = [...personalEvents].sort((a,b) => new Date(a.d) - new Date(b.d));
        sorted.forEach(e => {
            let div = document.createElement('div'); div.className = "tl-item";
            div.innerHTML = `<h3>${e.t}</h3><small>${e.d}</small><p>${e.n}</p>`;
            container.appendChild(div);
        });
    }

    // --- UTILS ---
    function getOrdinal(n) { const s=["th","st","nd","rd"], v=n%100; return s[(v-20)%10]||s[v]||s[0]; }
    
    // --- UPDATED RENDER BACKGROUND UPLOAD ---
    function renderBgUploadList() { 
        const list = document.getElementById('bg-upload-list'); list.innerHTML="";
        monthNames.forEach((m,i) => {
            // Added accept="image/*" here
            list.innerHTML += `<div style="margin-bottom:10px;"><b>${m}</b> <input type="file" accept="image/*" onchange="saveMonthBg(${i},this)"></div>`;
        });
    }

    function saveMonthBg(idx, input) {
        if (input.files && input.files[0]) {
            let file = input.files[0];
            const img = document.createElement('img');
            const reader = new FileReader();
            reader.onload = function(e) {
                img.src = e.target.result;
                img.onload = function() {
                    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                    const MAX_W = 1000; const scale = MAX_W / img.width;
                    canvas.width = MAX_W; canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    try { customBgs[idx] = canvas.toDataURL('image/jpeg', 0.6); localStorage.setItem('monthBgs', JSON.stringify(customBgs)); if(currentMonth===idx) renderCalendar(); alert("Saved!"); } catch(err) { alert("Storage Full!"); }
                }
            }
            reader.readAsDataURL(file);
        }
    }
    
    // --- ANIMATION & APP STATE ---
    function updateSeasonalAnimation() {
        const layer = document.getElementById('seasonal-layer'); layer.innerHTML = ""; clearInterval(particlesInterval);
        let type = (currentMonth === 11 || currentMonth === 0) ? "snow" : (currentMonth >= 5 && currentMonth <= 7) ? "rain" : (currentMonth >= 1 && currentMonth <= 3) ? "flower" : "";
        if(type) particlesInterval = setInterval(() => {
            const p = document.createElement('div'); p.classList.add('particle', type==='snow'?'snowflake':type==='flower'?'leaf':'rain');
            p.style.left = Math.random()*100+"vw"; p.style.animationDuration=(Math.random()*3+3)+"s";
            if(type==='flower') p.innerText = ["üå∏","üå∫"][Math.floor(Math.random()*2)];
            if(type==='snow') p.innerText = "‚ùÑ";
            layer.appendChild(p); setTimeout(()=>p.remove(),6000);
        }, 300);
    }

    function switchScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen')); document.getElementById(id).classList.add('active-screen'); }
    function changeMonth(d) { currentMonth += d; if(currentMonth > 11) { currentMonth = 0; currentYear++; } else if(currentMonth < 0) { currentMonth = 11; currentYear--; } renderCalendar(); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openAddModal() { document.getElementById('add-modal').style.display = 'flex'; }
    function openLoveScreen() { switchScreen('love-screen'); document.getElementById('daily-love-msg').innerText = "I Love You Auna! ‚ù§Ô∏è"; }
    function checkAutoTheme() {
        const saved = localStorage.getItem('appTheme');
        if(saved === 'auto' || !saved) { document.documentElement.setAttribute('data-theme', (new Date().getHours()>=6&&new Date().getHours()<18)?'light':'dark'); }
        else { document.documentElement.setAttribute('data-theme', saved); }
    }
    function saveNewEvent() {
        let d = document.getElementById('new-evt-date').value; let t = document.getElementById('new-evt-title').value; let n = document.getElementById('new-evt-note').value; let m = document.getElementById('new-evt-mood').value;
        if(d && t) { personalEvents.push({ id: Date.now(), d:d, t:t, n:n, mood:m }); localStorage.setItem('myEvents_v8', JSON.stringify(personalEvents)); alert("Saved!"); closeModal('add-modal'); renderCalendar(); updateCountdown(); }
    }
    function resetNavTimer() { const nav = document.getElementById('navbar'); nav.style.opacity = '1'; clearTimeout(autoHideTimer); autoHideTimer = setTimeout(() => { nav.style.opacity = '0'; }, 3000); }
</script>
</body>
</html>
